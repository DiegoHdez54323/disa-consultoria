---
import { Code, Cloud, Cpu, Palette, Workflow, Bot } from "lucide-astro";
import type { Service } from "../../sanity/types/services";

// Tiempo entre tarjetas del stagger (en ms)
const STAGGER_MS = 150;

interface Props {
  services: Array<
    Pick<Service, "icon" | "title" | "description" | "gradientIndex">
  >;
}

const { services } = Astro.props;

// Mapa de nombre de icono (string) -> componente de lucide-astro
const iconMap: Record<string, typeof Code> = {
  Code,
  Cloud,
  Cpu,
  Palette,
  Workflow,
  Bot,
};

function getIconComponent(iconName: string) {
  return iconMap[iconName] ?? Code; // fallback a Code si no existe el nombre
}
---

<section class="relative py-24 bg-background overflow-hidden">
  {/* Background elements */}
  <div class="absolute inset-0 bg-grid opacity-20"></div>
  <div
    class="absolute top-0 left-1/2 -translate-x-1/2 w-[800px] h-[400px] bg-primary/5 rounded-full blur-3xl"
  >
  </div>

  <div class="relative container mx-auto px-6">
    {/* Section Header */}
    <div class="text-center mb-16 scroll-reveal">
      <span
        class="inline-block px-4 py-1 rounded-full bg-primary/10 text-primary text-sm font-inter font-medium mb-4"
      >
        Nuestros Servicios
      </span>
      <h2
        class="font-orbitron text-3xl md:text-5xl font-bold text-foreground mb-4"
      >
        Soluciones que
        <span class="text-gradient-primary"> transforman</span>
      </h2>
      <p class="font-inter text-lg text-muted-foreground max-w-2xl mx-auto">
        Combinamos tecnología de vanguardia con metodologías ágiles para crear
        soluciones que impulsan tu negocio hacia el futuro.
      </p>
    </div>

    {/* Services Grid */}
    <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
      {
        services.map((service, index) => {
          const Icon = getIconComponent(service.icon);

          return (
            <div
              class="group relative scroll-reveal"
              style={`transition-delay: ${STAGGER_MS * (index + 1)}ms;`}
            >
              <div class="relative h-full p-8 rounded-2xl bg-gradient-card border border-border/50 overflow-hidden transition-all duration-500 hover:border-primary/30 hover:glow-primary">
                {/* Glow effect on hover */}
                <div
                  class={`absolute inset-0 bg-linear-to-br ${service.gradientIndex} opacity-0 group-hover:opacity-5 transition-opacity duration-500`}
                />

                {/* Icon */}
                <div
                  class={`relative w-14 h-14 rounded-xl bg-linear-to-br ${service.gradientIndex} p-0.5 mb-6`}
                >
                  <div class="w-full h-full rounded-xl bg-card flex items-center justify-center">
                    <Icon class="w-7 h-7 text-primary" />
                  </div>
                </div>

                {/* Content */}
                <h3 class="font-orbitron text-xl font-semibold text-foreground mb-3 group-hover:text-primary transition-colors">
                  {service.title}
                </h3>
                <p class="font-inter text-muted-foreground leading-relaxed">
                  {service.description}
                </p>

                {/* Bottom line accent */}
                <div
                  class={`absolute bottom-0 left-0 right-0 h-1 bg-linear-to-r ${service.gradientIndex} transform scale-x-0 group-hover:scale-x-100 transition-transform duration-500 origin-left`}
                />
              </div>
            </div>
          );
        })
      }
    </div>
  </div>
</section>
