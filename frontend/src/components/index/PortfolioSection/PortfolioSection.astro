---
import { Carousel3D } from "./Carousel3D";
import type { PortfolioProject } from "../../../sanity/types/portfolio";

const STAGGER_MS = 80;

interface Props {
  projects: PortfolioProject[];
}

const { projects } = Astro.props;
---

<section class="relative py-24 overflow-hidden">
  {/* Seamless Background */}
  <div class="absolute inset-0 bg-background"></div>
  <div class="absolute inset-0 bg-grid opacity-10"></div>
  <div
    class="absolute top-0 left-0 right-0 h-32 bg-linear-to-b from-background to-transparent"
  >
  </div>
  <div
    class="absolute bottom-0 left-0 right-0 h-32 bg-linear-to-t from-background to-transparent"
  >
  </div>
  <div
    class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-[800px] h-[800px] bg-primary/5 rounded-full blur-[120px]"
  >
  </div>
  <div
    class="absolute bottom-0 right-0 w-[500px] h-[500px] bg-secondary/5 rounded-full blur-[100px]"
  >
  </div>

  <div class="relative container mx-auto px-4">
    {/* Section Header */}
    <div
      class="text-center mb-12 fade-up-init"
      data-animate-on-scroll
      style={`transition-delay: 0ms;`}
    >
      <span
        class="inline-block px-4 py-1 rounded-full bg-secondary/10 text-secondary text-sm font-inter font-medium mb-4"
      >
        Portafolio
      </span>
      <h2 class="font-sora text-3xl md:text-5xl font-bold text-foreground mb-4">
        Proyectos que
        <span class="text-gradient-secondary"> inspiran</span>
      </h2>
      <p class="font-inter text-lg text-muted-foreground max-w-2xl mx-auto">
        Ideas disruptivas convertidas en soluciones reales. Cada proyecto es una
        historia de innovación y excelencia técnica.
      </p>
    </div>

    {/* Projects 3D Carousel */}
    <div
      class="fade-up-init"
      data-animate-on-scroll
      style={`transition-delay: ${STAGGER_MS * 2}ms;`}
    >
      <Carousel3D client:load projects={projects} />
    </div>
  </div>

  {/* Animación on-scroll tipo framer (fade + y) */}
  <script>
    if (typeof window !== "undefined") {
      const elements = document.querySelectorAll("[data-animate-on-scroll]");
      if (elements.length > 0) {
        const observer = new IntersectionObserver(
          (entries) => {
            for (const entry of entries) {
              if (entry.isIntersecting) {
                entry.target.classList.remove("fade-up-init");
                entry.target.classList.add("fade-up-in");
                observer.unobserve(entry.target);
              }
            }
          },
          { threshold: 0.2 }
        );
        elements.forEach((el) => observer.observe(el));
      }
    }
  </script>
</section>
